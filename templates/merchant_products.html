{% extends "merchant_header.html" %}

{% block title %}Merchant - Products{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2>Products</h2>

    <!-- Flash messages for errors or success -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="mt-3">
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Add New Item Button aligned to the right -->
    <div class="d-flex justify-content-end mb-3">
        <a href="{{ url_for('merchant_add_product') }}" class="btn btn-primary">Add New Item</a>
    </div>

    <!-- Display Products in a Table -->
    <table class="table table-striped mt-3">
        <thead>
            <tr>
                <th style="width: 10%;">Image</th>
                <th style="width: 10%;">Merchant Name</th>
                <th style="width: 10%;">Product ID</th>
                <th style="width: 15%;">Product Name</th>
                <th style="width: 25%;">Description</th>
                
                <th style="width: 5%;">Price</th>
                <th style="width: 10%;">Registered Date</th>
                <th style="width: 15%;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr>
                <td><img src="{{ product.ImageUrl }}" alt="{{ product.ProductName }}" width="100"></td>
                <td>{{ product.MerchantName }}</td>
                <td>{{ product.ProductID }}</td>
                <td>{{ product.ProductName }}</td>
                <td>
                    <!-- Truncate long descriptions -->
                    {% if product.Description|length > 100 %}
                        {{ product.Description[:100] }}...
                    {% else %}
                        {{ product.Description }}
                    {% endif %}
                </td>
                
                <td>${{ product.Price }}</td>
                <td>{{ product.RegisteredDate }}</td>
                <td>
                    <!-- Edit button -->
                    <a href="{{ url_for('merchant_edit_product', product_id=product.ProductID) }}" class="btn btn-warning btn-sm">Edit</a>

                    <!-- Delete button with confirmation -->
                    <form action="{{ url_for('merchant_delete_product', product_id=product.ProductID) }}" method="POST" style="display:inline;" onsubmit="return confirmDelete('{{ product.ProductName }}');">
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- JavaScript to confirm delete action -->
<script>
function confirmDelete(productName) {
    return confirm('Are you sure you want to delete the product: ' + productName + '?');
}
</script>

{% endblock %}
